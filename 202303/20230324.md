# 20230324

## [50 | 弹力设计篇之“降级设计”](https://time.geekbang.com/column/article/4252)

所谓的降级设计（Degradation），本质是为了解决资源不足和访问量过大的问题。当资源和访问量出现矛盾的时候，在有限的资源下，为了能够扛住大量的请求，我们就需要对系统进行降级操作。也就是说，暂时牺牲掉一些东西，以保障整个系统的平稳运行。

我们的降级需要牺牲掉的东西有：

- 降低一致性。从强一致性变成最终一致性。
- 停止次要功能。停止访问不重要的功能，从而释放出更多的资源。
- 简化功能。把一些功能简化掉，比如，简化业务流程，或是不再返回全量数据，只返回部分数据。

关于功能的简化上，上面的下单流程中已经提到过相应的例子了。而且，从缓存中返回数据也是其中一个。这里再提一个，就是一般来说，一个 API 会有两个版本，一个版本返回全量数据，另一个版本只返回部分或最小的可用的数据。

哪些是 must-have 的功能，哪些是 nice-to-have 的功能；哪些是必须要死保的功能，哪些是可以牺牲的功能


前端的程序可以根据后端传来的数据来决定展示哪些界面模块。比如，当前端收不到商品评论时，就不展示

降级的这些业务流程和功能有可能长期不用而出现 bug 或问题，对此，需要在平时做一些演练。

小结好了，我们来总结一下今天分享的主要内容。首先，降级设计本质上是为了解决资源不足和访问量过大的问题。降级的方法有降低一致性、停止次要功能和简化功能

### comment

#### 来

```
我们现在的降级分为功能降级和服务降级。我们目前将降级开关放到配置中心。
一、功能降级
1、通过降级开关控制功能可用不可用，一般为页面和按钮
2、简化业务操作流程，当降级后简化业务操作步骤，快速完成业务操作
二、服务降级
1、读降级，降级前会读缓存，缓存中不存在的话读数据库，降级后读缓存，缓存中不存在的话，返回默认值，不再读数据库
2、写降级，将之前的同步写数据库降级为先写缓存，然后异步写库
3、服务调用降级，之前两个系统模块通过mq来交互，当mq消息积压或mq宕机出问题后，降级为服务直接调用
2018-06-09

来
关于降级突然想到了生活中一个类似降级的场景：
现在小饭馆都支持网上订餐，当餐厅内客人不多的时候，餐厅老板或者服务员会去出去送餐，而当餐厅内客户突然增多，服务员忙不过来的时候，一般会进行降级，降级的策略是将外卖配送交给第三方来配送，或者在某个时间段内暂不支持网上订餐，这种情况类似于功能降级。还有一个场景就是关于餐厅炒菜，当餐厅内食客少的时候，大厨一般会现点现炒，而当食客多忙不过来的时候，一般会提前将菜炒好，客人点完就可以吃到，将热菜降级为快餐，这种情况类似于服务降级。纯属个人理解，如有不妥，还请见谅。
2018-06-09
```

#### escray

```

降级设计，解决资源不足和访问量过大的问题。

降级的策略

1. 降低一致性：使用异步简化流程，降低数据一致性
2. 停止次要功能：限制流量，退化功能，停止功能
3. 简化功能：

降级和限流都需要事前对业务做出梳理，确定那些是 must-have，需要事前设计好，而且最好都有可配置的开关。

看到留言里面，可以把降级分为功能降级和服务降级，受教了。

有一点好奇，如果在最开始设计的时候，感觉系统不会出现资源不足或者访问量过大的时候，比如内部系统，是否还需要考虑降级设计？

顺路去看了一下《缓存更新的套路》，发现是 2016 年的文章，但是现在看起来也毫不过时。

* Cache Aside 
* Read/Write Through
* Write Behind Caching

多一些套路，少一些轮子

其实主要的问题还是眼界。
```

#### Michael

```
降级设计：解决资源不足和访问量过大的问题。有限的资源扛住大量的请求，就需要对系统进行降级处理。在降级处理的过程中，需要与以下内容做些折中：
1. 降低一致性：从强一致性变成最终一致性
2. 停止次要功能：停止访问不重要的功能
3. 简化功能：把一些简单功能去掉，简化业务流程

降级设计的要点
1. 业务的深度理解
2. 读操作，缓存解决；写操作，异步处理
3. 降级功能的开关是可配置开关
4. 后端服务可感知

感想：降级设计中，后端可感知，将是否降级加入到协议头中作为参数传输，这个必要性很重要，后端根据传递的参数进行预判。
```

## 固定片尾

此文单为3月Day06学习笔记, 内容来源于极客时间<<左耳听风>> <<SQL必知必会作>> <<TDD项目实战70讲>> 等, 强烈推荐该课程!