# 20230321

## [47 | 弹力设计篇之“重试设计”](https://time.geekbang.org/column/article/4121)


“重试”的语义是我们认为这个故障是暂时的，而不是永久的，所以，我们会去重试。


设计重试时，我们需要定义出什么情况下需要重试，例如，调用超时、被调用端返回了某种可以重试的错误（如繁忙中、流控中、维护中、资源不足等）。

都需要有个重试的最大值，经过一段时间不断的重试后，就没有必要再重试了，应该报故障了。在重试过程中，每一次重试失败时都应该休息一会儿再重试，这样可以避免因为重试过快而导致网络上的负担加重。

Exponential Backoff 的策略，也就是所谓的“指数级退避”。

ExponentialRandomBackOffPolicy：随机指数退避策略，引入随机乘数，之前说过固定乘数可能会引起很多服务同时重试导致 DDos，使用随机休眠时间来避免这种情况。重试设计的重点

的，像 Java 那样可以使用 Annotation 的方式（在 Spring 中你可以用到这样的注解），如果没有注解也可以包装在底层库或是 SDK 库中不需要让上层业务感知到。另外一种是走 Service Mesh 的方式

好了，我们来总结一下今天分享的主要内容。首先，我讲了重试的场景，比如流控，但并不是所有的失败场景都适合重试。接着我讲了重试的策略，包括简单的指数退避策略，和 Spring 实现的多种策略。这些策略可以用 Java 的 Annotation 来实现，或者用 Service Mesh 的方式，从而不必写在业务逻辑里。最后，我总结了重试设计的重点。下节课，我们讲述熔断设计。希望对你有帮助。

好了，我们来总结一下今天分享的主要内容。首先，我讲了重试的场景，比如流控，但并不是所有的失败场景都适合重试。接着我讲了重试的策略，包括简单的指数退避策略，和 Spring 实现的多种策略。这些策略可以用 Java 的 Annotation 来实现，或者用 Service Mesh 的方式，从而不必写在业务逻辑里。最后，我总结了重试设计的重点。下节课，我们讲述熔断设计。希望对你有帮助。

### comment

#### escray

```
超时可以重试，业务和技术上的错误不需要重试。

指数级退避 Exponential Backoff

看了 Spring 的 重试 Retry 和 退避 Backoff 策略，以后如果有机会可以照猫画虎。

重试的设计重点：

1. 确定什么样的错误重试
2. 根据错误的类型确定重试的时间和次数、退避策略
3. 重试之后的错误处理或者是熔断设计

看上去 Annotation 的方式更好一些。
2023-03-17归属地：北京
```

## 固定片尾

此文单为3月Day06学习笔记, 内容来源于极客时间<<左耳听风>> <<SQL必知必会作>> <<TDD项目实战70讲>> 等, 强烈推荐该课程!