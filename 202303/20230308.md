# 20230308

## 23 | [分布式系统的技术栈](https://time.geekbang.org/column/article/1512)

现在你知道为什么 Docker 这样的容器化虚拟化技术是未来了吧。因为分布式系统已经是完全不可逆转的技术趋势了。

总结一下上面讲述的内容，你不难发现，分布式系统有五个关键技术，它们是： 全栈系统监控； 服务 / 资源调度； 流量调度； 状态 / 数据调度； 开发和运维的自动化。

而最后一项——开发和运维的自动化，是需要把前四项都做到了，才有可能实现的。所以，最为关键是下面这四项技术，即应用整体监控、资源和服务调度、状态和数据调度及流量调度，它们是构建分布式系统最最核心的东西。

我总结了分布式系统需要干的两件事：一是提高整体架构的吞吐量，服务更多的并发和流量，二是为了提高系统的稳定性，让系统的可用性更高。然后分别从这两个方面阐释，需要通过哪些技术来实现，并梳理出其中的技术难点及可能会带来的问题。

大流量处理。通过集群技术把大规模并发请求的负载分散到不同的机器上。 关键业务保护。提高后台服务的可用性，把故障隔离起来阻止多米诺骨牌效应（雪崩效应）。如果流量过大，需要对业务降级，以保护关键业务流转。

### 评论摘抄

#### William Ning

```
收获

1. 构建分布式系统的目的是增加系统容量，提高系统的可用性，转换成技术方面，也就是完成下面两件事。
-- 大流量处理。通过集群技术把大规模并发请求的负载分散到不同的机器上。
-- 关键业务保护。提高后台服务的可用性，把故障隔离起来阻止多米诺骨牌效应（雪崩效应）。如果流量过大，需要对业务降级，以保护关键业务流转。

说白了就是干两件事。一是提高整体架构的吞吐量，服务更多的并发和流量，二是为了提高系统的稳定性，让系统的可用性更高

2.提高架构性能
1.缓存：缓存系统 缓存分区，缓存命中，缓存更新
2.负载均衡：网关系统 负载均衡，服务路由，服务发现
3.异步调用：异步系统 消息队列，消息持久，异步事务
4.数据镜像：数据镜像 数据同步，数据分离，数据一致性
5.数据分区：数据分区 分区策略，数据访问层，数据一致性

3.提高架构稳定性：
1.服务拆分：服务治理 服务调用，依赖，隔离
2.服务冗余：服务调度 弹性伸缩，故障转移，服务发现
3.限流降级：降级限流 异步队列服务降级，限流熔断
4.高可用架构：高可用架构 多租户系统，宰被多活，高可用服务
5.高可用运维：高可用运维 全栈监控 devops，自动化运维


4.引入的问题
但是引入分布式系统，会引入一堆技术问题, 解决方法:
-- 服务治理
-- 架构软件管理
-- DevOps。
-- 自动化运维。
-- 资源调度管理
-- 整体架构监控。
-- 流量控制。

备注:
由上可知, 要实现出来得投入多少人力、物力和时间啊。是的，这就是分布式系统中最大的坑。

5.引入的问题的解决方案  --- Docker
我们应该庆幸自己生活在了一个非常不错的年代。今天有一个技术叫——Docker，通过 Docker 以及其衍生出来的 Kubernetes 之类的软件或解决方案，大大地降低了做上面很多事情的门槛。

现在你知道为什么 Docker 这样的容器化虚拟化技术是未来了吧。因为分布式系统已经是完全不可逆转的技术趋势了。

6.总结  -- 分布式系统的“纲”
总结一下上面讲述的内容，你不难发现，分布式系统有五个关键技术，它们是：
-- 全栈系统监控；
-- 服务 / 资源调度；
-- 流量调度；
-- 状态 / 数据调度；
-- 开发和运维的自动化。


而最后一项 —— 开发和运维的自动化，是需要把前四项都做到了，才有可能实现的。
所以，最为关键是下面这四项技术，即应用整体监控、资源和服务调度、状态和数据调度及流量调度，它们是构建分布式系统最最核心的东西.

Over
```

## 24 | [分布式系统关键技术：全栈监控](https://time.geekbang.org/column/article/1513)

我们需要全栈系统监控，它就像是我们的眼睛
故障发生不可怕，可怕的是故障的恢复时间过长。所以，快速地定位故障就相当关键

在把数据收集好的同时，更重要的是把数据关联好。这样，我们才可能很快地定位故障，进而才能进行自动化调度


### 所谓全栈监控，其实就是三层监控。 

基础层：监控主机和底层资源。比如：CPU、内存、网络吞吐、硬盘 I/O、硬盘使用等。 
中间层：就是中间件层的监控。比如：Nginx、Redis、ActiveMQ、Kafka、MySQL、Tomcat 等。 
应用层：监控应用层的使用。比如：HTTP 访问的吞吐量、响应时间、返回码、调用链路分析、性能瓶颈，还包括用户端的监控。

这还需要一些监控的标准化。 日志数据结构化； 监控数据格式标准化； 统一的监控平台； 统一的日志分析。


### 监控系统都做得很不好

现在我们的很多监控系统都做得很不好，它们主要有两个很大的问题。 

-监控数据是隔离开来的。
-监控的数据项太多。

### 一个好的监控系统应该有以下几个特征。

- 关注于整体应用的 SLA。
- 关联指标聚合。
- 快速故障定位

### 如何做出一个好的监控系统 

下面是我认为一个好的监控系统应该实现的功能。 

- 服务调用链跟踪。
- 服务调用时长分布
- 服务的 TOP N 视图。
- 数据库操作关联
- 服务资源跟踪

## MISC

### IDEA 启动杂项

```
-Xms128m
-Xmx958m
-XX:ReservedCodeCacheSize=240m
-XX:+UseConcMarkSweepGC
-XX:SoftRefLRUPolicyMSPerMB=50
-ea
-XX:CICompilerCount=2
-Dsun.io.useCanonPrefixCache=false
-Djdk.http.auth.tunneling.disabledSchemes=""
-XX:+HeapDumpOnOutOfMemoryError
-XX:-OmitStackTraceInFastThrow
-Djdk.attach.allowAttachSelf=true
-Dkotlinx.coroutines.debug=off
-Djdk.module.illegalAccess.silent=true
-javaagent:C:\Users\Public\.jetbrains\jetbrains-agent-v3.2.0.de72.619

```

### capslockPlus config

```
;------------ Encoding: UTF-16 ------------
;请对照 CapsLock+settingsDemo.ini 来配置相关设置
[Global]

loadScript=scriptDemo.js

[QSearch]

[QRun]

[QWeb]

[TabHotString]

[QStyle]

[TTranslate]

[Keys]
press_caps=keyFunc_esc

;move
caps_j=keyFunc_moveDown
caps_k=keyFunc_moveUp
caps_h=keyFunc_moveLeft
caps_l=keyFunc_moveRight

;del and backspace
caps_i=keyFunc_backspace
caps_o=keyFunc_delete


```

## 固定片尾

此文单为3月Day06学习笔记, 内容来源于极客时间<<左耳听风>> <<TDD项目实战70讲>> 等, 强烈推荐该课程!