# 20230403

## [56 | 管理设计篇之“网关模式”](https://time.geekbang.org/column/article/6086)



这张图展示了一个多层 Gateway 架构，其中有一个总的 Gateway 接入所有的流量，并分发给不同的子系统，还有第二级 Gateway 用于做各个子系统的接入 Gateway。可以看到，网关所管理的服务粒度可粗可细。通过网关，我们可以把分布式架构组织成一个星型架构，由网络对服务的请求进行路由和分发，也可以架构成像 Servcie Mesh 那样的网格架构，或者只是为了适配某些服务的 Sidecar……

Gateway 是一个服务器，也可以说是进入系统的唯一节点。这跟面向对象设计模式中的 Facade 模式很像。Gateway 封装内部系统的架构，并且提供 API 给各个客户端。它还可能有其他功能，如授权、监控、负载均衡、缓存、熔断、降级、限流、请求分片和管理、静态响应处理

Gateway、Sidecar 和 Service Mesh通过上面的描述，我们可以看到，网关、边车和 Service Mesh 是非常像的三种设计模式，很容易混淆。因此，我在这里想明确一下这三种设计模式的特点、场景和区别。


### 网关的设计重点

- 第一点是高性能
- 第二点是高可用 
- 第三点是高扩展


DevOps。因为网关这个组件太关键了，所以需要 DevOps 这样的东西，将其发生故障的概率降到最低。这个软件需要经过精良的测试，包括功能和性能的测试，还有浸泡测试。还需要有一系列自动化运维的管控工具。

这里多说一句，网关处理的静态内容应该靠近用户（应该放到 CDN 上），而网关和此时的动态服务应该靠近后端服务

#### comment

##### nut

```
分享一下我们用到的网关，工作中内网微服务主要是HSF，而网关对我们来说，是服务对外开放给外部用户的渠道，他帮我们实现了软件商的资格审核备案，API调用权限管理，用户和软件商的三方授权，调用健康度管理，用户纬度的限流熔断，API内部协议和外部协议之间的转换，全球网络专线的优化，API纬度的监控告警。

大家工作中的网关都是什么用途呢？
2018-05-15
```

#### 约书亚

```
关于网关看了很多资料，也有项目实践，但始终很困惑，请点播一二
从我收集的资料来看，微服务网关一般有如下作用：路由/流控，鉴权，协议转换，服务聚合/编排，监控，日志，熔断，限流...
我现在的架构，前面nginx只做路由，下游接“不同大业务块的网关”，这个网关简单理解就是人工编码的应用，未采用zuul，kong一类开源组件，做以上所有工作，我一直觉得以上设计和其他文章中对网关的定义差异很大，仿佛他们的网关能通过一个统一框架实现所有事情，除了聚合/编排
我的疑问是，能不能说鉴权算不算一种业务逻辑？因为有的鉴权比较复杂，聚合和编排是否更涉及到了业务逻辑？如果整个系统只有在用户-系统的边界有一/几个网关，如果其中包含了大量的鉴权和聚合/编排，那就太臃肿了？既然网关的功能这么复杂，现在的主流框架主要还是解决性能和路由的问题，那还要他们干什么呢？随便一个高效的web框架不是也可以么？（只考虑7层）
那在我们设计系统中，在思考“网关到底要承载哪些功能”时，什么样的参数是要重点考虑的呢？有什
建议极客时间的所有课程增加定期答疑的环节
2018-05-03
```


#### escray

```
Gateway 应该就是皓叔的创业方向了，感觉是在 Sidecar 和 Service Mesh 上做了进一步的抽象（功能合并？）。

网关的功能：请求路由，服务注册，负载均衡，弹力设计（异步、重试、幂等、流控、熔断、监视），安全（SSL加密及证书管理、Session 验证、授权、数据校验、攻击防范），灰度发布，API 聚合，API 编排

感觉网关的功能和 Sidecar 和 Service Mesh 类似，解决的都是同一类问题。

Sidecar 方式主要用来改造已有服务，同时负责进出请求；
Sidecar 多了之后，把非业务功能实现在 Sidecar 和 Controller 中，形成 Service Mesh；
简化 Service Mesh，调整 Sidecar 的粒度，形成只负责进入请求的 Gateway。

网关和边车 Sidecar、服务网格 Service Mesh 一样，需要高性能、高可用、高扩展设计。

感觉上，在专栏最后一部分网关的设计重点，从原则、运维、架构到安全，适合每一个分布式架构中的关键模块。

去看了一眼皓叔的 MegaEase，发现已经是一个“一键部署顶级互联网公司云原生开源软甲架构的” Cloud Native 平台了。
2023-03-28归属地：北京
```


## 固定片尾

此文单为4月学习笔记, 内容来源于极客时间<<左耳听风>> <<SQL必知必会作>> <<TDD项目实战70讲>> 等, 强烈推荐该课程!