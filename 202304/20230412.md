# 20230412

## 61 | 性能设计篇之“秒杀”(https://time.geekbang.org/column/article/7047)


秒杀的流程“秒杀”其实是商家为了促销，使用非常低的价格销售商品，比如，1 元卖 iPhone，100 台，于是来了一百万人抢购。

当秒杀开始的时候，这 100 万用户都在点下单按钮，首先他们请求到的是 CDN 上的这些服务，这些小服务按照 0.02% 的量把用户放到后面的数据中心，也就是 1 万个人放过去两个，剩下的 9998 个都直接返回秒杀已结束。

我们可以看到，解决秒杀这种特定业务场景，可以使用 CDN 的边缘结点来扛流量，然后过滤用户请求（限流用户请求），来保护数据中心的系统，这样才让整个秒杀得以顺利进行。

尤其是针对一些有地域特征的业务，比如像外卖、共享单车、打车这样的业务。其实，把一些简单的业务逻辑放在边缘，比放
在数据中心不但能够有更好的性能，还有更便宜的成本。


首先，我介绍了秒杀。先是分析了其业务流程，并列举了其所面临的技术挑战，随后介绍了其解决方案。接着，分析了相关的奥运会和 12306 抢票问题，以及双十一购物节问题。它们各自有不同的解决思路，其中双十一则要求我们必须认认真真地用高并发架构来应对。最后，从秒杀解决方案中的 CDN 边缘节点计算，我引出了普适的边缘节点计算。



### comment

#### 一飞

```
某东逻辑是这样的：网关限流，单机限流（流量值可以在压测时评估出来），redis 扣减库存key（定时load库存），数据库扣减库存，如果都成功的话，用户拿到这个券了。
2018-05-23
```


#### mgxian
```
文章里说的CDN是我们平常是的CDN吗？ CDN不是只能缓存一些静态内容的吗？难道还可以放代码，执行业务逻辑吗？
作者回复: CDN当然可以执行逻辑，但是你要去谈商务合作。

2018-05-22
```


### 刘匿名

```
平时谈秒杀，我们一般习惯性从业务服务或者数据中心出发考虑怎么解决问题，文章里提的通过边缘节点过滤请求，降低业务压力的思路倒是很少想过。
这种思路的确很通用，很多场景下都用得到，感谢
2020-10-17
```

### escray
```

极客时间好像有专门的“秒杀”专栏，不过从皓叔的专栏来看，确实没有那么“难”。

使用 CDN 分流访问，包括页面缓存，在线人数统计以及概率抽签。

专栏里面，关于 12306 的解决方案其实也挺好的，收集需求、整体统筹、抽签摇号，不过可能还会有信任的问题。

其他地方有关秒杀的介绍，其实更多类似于双十一的场景，做高并发、性能规划、弹力设计之类的。

专栏里面提到“数据中心有点到瓶颈了，需要边缘节点来帮忙”，这个似乎也是系统整体优化的一部分，特别是现在边缘的计算能力越来越强。

期待下一篇，皓叔介绍边缘计算相关的创业方向，这个和之前的那个 API 网关似乎不太一样。

不太理解为什么在性能设计这部分总有人觉得“水”，其实在之前分布式推荐阅读那里，全是干货，估计有生之年都看不完。也许大家都期待能够有人“醍醐灌顶”，这个目前真的不太可能。
2023-03-28归属地：北京
```


## 固定片尾

此文单为4月学习笔记, 内容来源于极客时间<<左耳听风>> <<SQL必知必会作>> <<TDD项目实战70讲>> 等, 强烈推荐该课程!